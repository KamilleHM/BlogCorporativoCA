"use strict";function Tracksale(){const e="noventena",n="tracksale-widget";var t=window.location.origin.indexOf("tracksale.local")>-1?"https://tracksale.local":"https://tracksale.co",o=null,r={},i=90,a=null,c="",l="",d=null,s=function(){return o.localStorage?null!==(e=localStorage.getItem(n))?(e=JSON.parse(e),(new Date).getTime()>e.timestamp?(localStorage.removeItem(n),null):e.value):null:function(){for(var e=n+"=",t=document.cookie.split(";"),o=0;o<t.length;o++){for(var r=t[o];" "===r.charAt(0);)r=r.substring(1);if(-1!=r.indexOf(e))return r.substring(17,r.length)}return null}();var e},p=function(e,t){o.localStorage?function(e,t){var o={value:e,timestamp:(new Date).getTime()+24*t*60*60*1e3};localStorage.setItem(n,JSON.stringify(o))}(e,t):function(e,t){var o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3);var r="expires="+o.toUTCString();document.cookie=n+"="+e+"; "+r+"; path=/"}(e,t)},m=function(e){var n="";return void 0!==o.identification&&""!==o.identification?n=o.identification:void 0!==o.email&&""!==o.email&&(n=o.email),n===e},u=function(){""===l?document.querySelector("meta[name=viewport]").parentNode.removeChild(document.querySelector("meta[name=viewport]")):document.querySelector("meta[name=viewport]").setAttribute("content",l)},f=function(){return`\n        ${function(){if(!d)return"";var e=d.container.backgroundColor,n=d.container.pt+"px "+d.container.pr+"px "+d.container.pb+"px "+d.container.pl+"px ";return"modal"===a?`\n          div.step1,\n          div.step2,\n          div.step3 {\n              padding: ${n};\n          }\n\n          body {\n              background-color: ${e};\n          }\n\n          .brand {\n              position: static;\n              padding: ${n};\n          }\n        `:`\n        body {\n          background-color: ${e};\n          overflow: hidden;\n        }\n\n        .brand {\n          position: static;\n        }\n\n        .close {\n          margin-top: 0px;\n        }\n      `}()}\n        ${d?`\n        p.salute {\n            font-size: ${d.salute.fontSize+"px"};\n            color: ${d.salute.color};\n            padding: ${d.salute.pt+"px "+d.salute.pr+"px "+d.salute.pb+"px "+d.salute.pl+"px "};\n            margin: 0;\n        }\n      `:""}\n        ${d?`\n        p.question {\n            font-size: ${d.question.fontSize+"px"};\n            color: ${d.question.color};\n            padding: ${d.question.pt+"px "+d.question.pr+"px "+d.question.pb+"px "+d.question.pl+"px "};\n            margin: 0;\n        }\n      `:""}\n      `},g=function(){if(!d)return"";var e=d.container.backgroundColor,n=function(){if(!d)return"inherit";var e={24:128,20:82,16:70,12:60};return"box"===a||"bar"===a?40+Number(d.container.pt)+Number(d.question.pt)+Number(d.question.pb)+(e[Number(d.question.fontSize)]||0):120+Number(d.container.pt)+Number(d.question.pt)+Number(d.question.pb)+(e[Number(d.question.fontSize)]||0)}()+"px",t=d.container.pt+"px "+d.container.pr+"px "+d.container.pb+"px "+d.container.pl+"px ";return"modal"===a?`\n          #tracksale-wrapper {\n            background-color: ${e};\n            padding: ${t};\n          }\n\n          #tracksale-iframe {\n              height: ${n};\n          }\n        `:"embedded"===a?`\n          #tracksale-wrapper {\n            background-color: ${e};\n            padding: ${t};\n          }\n        `:`\n        #tracksale-wrapper {\n          background-color: ${e};\n          padding: ${t};\n          height: ${n};\n        }\n\n        #tracksale-wrapper iframe {\n          height: ${n};\n        }\n      `},v=function(e){var n=[];for(var t in e)"campaign"!==t&&"key"!==t&&"type"!==t&&"theme"!==t&&"email"!==t&&"identification"!==t&&"name"!==t&&"reminder"!==t||e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")},y=function(){var e,n,r=document.getElementById("tracksale-wrapper");if(null===r){(n=document.createElement("link")).rel="stylesheet",n.type="text/css",n.href="https://cdn.tracksale.co/tracksale-js/external/"+a+".css?v=1.1.4",n.id="tracksale-theme",document.body.appendChild(n),function(){var e=document.getElementsByTagName("meta");if(e&&void 0!==e)for(var n=0;n<e.length;n++)"viewport"===e[n].getAttribute("name")&&(l=e[n].getAttribute("content"));if(""===l){var t=document.createElement("meta");t.name="viewport",t.content="user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}else-1===l.indexOf("user-scalable")&&document.querySelector("meta[name=viewport]").setAttribute("content",l+", user-scalable=no")}(),d&&((e=document.createElement("style")).id="widget-override-styles",e.innerHTML=g(),document.body.appendChild(e),o.overrides=f()),(r=document.createElement("div")).id="tracksale-wrapper",r.style.display="none",r.className=c;var i=document.createElement("div");i.id="tracksale-content";var s=document.createElement("iframe");s.id="tracksale-iframe",s.src=t+"/widget/?"+v(o),s.setAttribute("frameborder","0"),"modal"!==a&&i.appendChild(s),r.appendChild(i),"modal"===a&&r.appendChild(s),"modal"===a&&(i.onclick=function(){document.getElementById("tracksale-wrapper").style.display="none",document.getElementById("tracksale-iframe").contentWindow.postMessage("close-ui","*")});var p=null;"embedded"===a&&(p=document.getElementById(o.appendTo)),null===p?document.body.appendChild(r):(p.style.display="none",p.appendChild(r))}},w=function(){var e=3,n=document.createElement("div"),t=n.getElementsByTagName("i");do{n.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(t[0]);return e>4?e:document.documentMode}(),h=function(n){if(void 0!==o.campaign&&void 0!==o.key){if("tst"===o.campaign&&"tst"===o.key)return a=o.theme,void n(!0);if(w<10||"function"!=typeof window.postMessage)n(!1,!0,"Can't open in this browser.");else{var r,l=function(){var n=s();if(null===n)return!0;var t=!1;return-1!=n.indexOf(e)&&(t=!0,n=n.replace(e+".","")),!m(n)||(t?"Noventena":"Cookie rule.")}();if(!0===l||"string"!=typeof l)(r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);1==e.success?(i=e.expire_after,a=e.type,c=e.style,d=e.overrides,o.reminder=e.reminder,n(!0)):n(!1,!1,e.msg)}},r.open("GET",t+"/widget/check?"+v(o)),r.send();else n(!1,!1,l)}}else n(!1,!0,"Check widget settings.")},k=function(e){(o=e).isPreview=!!o.preview,o.name=o.name||"",o.identification=o.identification||"",o.email=o.email||"",o.salute=o.salute||"",o.tags=o.tags||{},o.thanks=o.thanks||"",o.appendTo=o.appendTo||"",o.answered=o.answered||!1,o.isPreview&&(o.theme=o.preview.type),(void 0===o.require_comment||!0!==o.require_comment&&!1!==o.require_comment)&&(o.require_comment=!1),o.reminder=parseInt(o.reminder),(isNaN(o.reminder)||o.reminder<0)&&(o.reminder=90),o.localStorage=function(){try{return localStorage.setItem("ts","ts"),localStorage.removeItem("ts"),!0}catch(e){return!1}}()&&(o.localStorage||!1),["onClose","onOpen","onAnswer","onError","onWarning","onUpdateInfo"].forEach((function(e){"function"==typeof o[e]&&(r[e]=o[e]),delete o[e]}))};this.init=function(e){if(k(e),!!e.preview)return a=e.preview.type,c=e.preview.style,d=e.preview.overrides,void y();h((function(e,n,t){e?y():n?("function"==typeof r.onError&&r.onError({msg:t},o),console.error(t)):("function"==typeof r.onWarning&&r.onWarning({msg:t},o),console.warn(t))}))},this.destroy=function(){var e=document.getElementById("tracksale-wrapper"),n=document.getElementById("widget-override-styles"),t=document.getElementById("tracksale-theme");e&&e.remove(),n&&n.remove(),t&&t.remove()},window.addEventListener("message",(function(n){var t,c=n.data;if("string"==typeof c){if("close-tracksale"===c||"close-tracksale-now"===c)t=""!==o.identification?o.identification:o.email,p(e+"."+t,i),"embedded"!==a&&setTimeout((function(){document.getElementById("tracksale-wrapper").style.display="none"}),"close-tracksale"===c?3e3:0),u();else if("ready-tracksale"===c){if(p(""!==o.identification?o.identification:o.email,o.reminder),document.getElementById("tracksale-iframe").contentWindow.postMessage(o,"*"),document.getElementById("tracksale-wrapper").style.display="block","embedded"===a){var l=document.getElementById(o.appendTo);null!==l&&(l.style.display="block")}"function"==typeof r.onOpen&&r.onOpen(o)}else if("close"===c)p(""!==o.identification?o.identification:o.email,o.reminder),document.getElementById("tracksale-wrapper").style.display="none","function"==typeof r.onClose&&r.onClose(o),u();else if("check-answered"===c){s()===e+"."+(""!==o.identification?o.identification:o.email)&&document.getElementById("tracksale-iframe").contentWindow.postMessage("answered","*")}}else"object"==typeof c&&("answer"===c.event?"function"==typeof r.onAnswer&&r.onAnswer(c.data,o):"updateInfo"===c.event?"function"==typeof r.onUpdateInfo&&r.onUpdateInfo(c.data,o):"grow"===c.event&&(document.getElementById("tracksale-wrapper").style.height=c.data.height+"px",document.getElementById("tracksale-iframe").style.height=c.data.height+"px"))}))}